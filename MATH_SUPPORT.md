# 数学公式支持说明

MonkeyOCR WebApp 现已支持 LaTeX 数学公式渲染，使用 KaTeX 引擎提供高质量的数学公式显示。

## 支持的语法

### 内联数学公式
使用单个 `$` 包围数学表达式：
```markdown
这是一个内联公式：$E = mc^2$
```

### 块级数学公式
使用双 `$$` 包围数学表达式：
```markdown
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$
```

## 支持的 LaTeX 命令

### 基本数学符号
- 希腊字母：`\alpha`, `\beta`, `\gamma`, `\Delta`, `\Omega` 等
- 运算符：`\sum`, `\prod`, `\int`, `\lim`, `\frac`, `\sqrt` 等
- 关系符号：`\le`, `\ge`, `\ne`, `\approx`, `\equiv` 等

### 预定义宏
- `\RR` → `\mathbb{R}` (实数集)
- `\NN` → `\mathbb{N}` (自然数集)
- `\ZZ` → `\mathbb{Z}` (整数集)
- `\QQ` → `\mathbb{Q}` (有理数集)
- `\CC` → `\mathbb{C}` (复数集)

### 矩阵和数组
```latex
$$\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}$$
```

### 多行公式
```latex
$$\begin{align}
x &= a + b \\
y &= c + d
\end{align}$$
```

## 特性

### ✅ 支持的功能
- **错误容忍**：不会因为公式错误而中断整个文档渲染
- **响应式设计**：在移动设备上自动调整大小
- **主题适配**：自动适应浅色/深色主题
- **性能优化**：使用 KaTeX 快速渲染
- **复制友好**：可以选择和复制渲染后的公式

### 🎨 样式特点
- 与文档主题一致的颜色
- 适当的边距和间距
- 在小屏幕上的响应式缩放
- 错误公式的友好显示

### 📱 移动端优化
- 块级公式支持水平滚动
- 字体大小自动调整
- 触摸友好的交互

## 使用示例

完整的数学公式示例可以在 `/demo_files/math_test.md` 文件中找到，包括：

1. 物理公式：`$E = mc^2$`, `$F = ma$`
2. 数学公式：欧拉公式、傅里叶变换、泰勒级数
3. 复杂表达式：矩阵运算、积分方程
4. 混合文本：内联公式与文字的结合

## 技术实现

- **引擎**：KaTeX v0.16.22
- **插件**：remark-math + rehype-katex
- **渲染器**：@uiw/react-markdown-preview
- **样式**：自定义 CSS 覆盖确保主题一致性

## 故障排除

### 公式不显示
1. 检查 LaTeX 语法是否正确
2. 确保使用正确的分隔符（`$` 或 `$$`）
3. 查看浏览器控制台是否有错误信息

### 样式问题
1. 确保 KaTeX CSS 已正确加载
2. 检查自定义主题是否覆盖了数学公式样式
3. 在不同主题下测试显示效果

### 性能问题
- KaTeX 比 MathJax 更快，但复杂公式仍需时间渲染
- 大量公式的文档可能需要额外加载时间
- 考虑将复杂公式拆分为多个简单公式