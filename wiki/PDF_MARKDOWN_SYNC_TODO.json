{
  "项目名称": "PDF与Markdown对照查阅功能实施计划",
  "创建日期": "2025-08-06",
  "版本": "1.0",
  "概述": "基于现有处理数据实现PDF预览与Markdown内容的双面板同步对照功能",
  
  "需求分析": {
    "核心功能": [
      "左侧PDF预览页面，带区块序号标记",
      "右侧Markdown转写结果，带区块序号标记",
      "两侧内容一一对应，支持同步滚动",
      "支持点击任意侧标记块，另一侧对应高亮",
      "保持现有对照标签页框架和操作体验"
    ],
    "数据基础": {
      "JSON数据结构": "backend/static/{task_id}/tmpXXX_middle.json",
      "关键字段": {
        "preproc_blocks[]": "预处理内容块数组",
        "index": "区块唯一序号，用于映射",
        "bbox": "区块坐标 [x1, y1, x2, y2]",
        "type": "区块类型：text/title/image",
        "content": "文本内容",
        "page_num": "页面编号",
        "page_size": "页面尺寸 [width, height]"
      }
    }
  },

  "技术方案": {
    "PDF渲染增强": {
      "技术选型": "基于现有FilePreview组件，集成canvas叠加层",
      "区块标记": "在PDF页面上绘制半透明矩形框和序号标签",
      "坐标转换": "将JSON中的bbox坐标转换为PDF显示坐标",
      "交互支持": "点击区块高亮，鼠标悬停显示内容预览"
    },
    "Markdown增强": {
      "区块标记": "在Markdown内容中插入区块ID标记",
      "内容映射": "通过content字段匹配JSON区块与Markdown段落",
      "样式设计": "为对应区块添加可点击和高亮样式",
      "滚动定位": "支持滚动到指定区块位置"
    },
    "同步机制": {
      "状态管理": "使用React state管理当前选中区块ID",
      "滚动同步": "监听滚动事件，计算可视区域内的区块",
      "交互同步": "点击任一侧区块，另一侧自动滚动并高亮",
      "缓存优化": "缓存区块位置信息，提升响应速度"
    }
  },

  "实施阶段": {
    "阶段1": {
      "名称": "数据处理和接口设计",
      "状态": "已完成",
      "完成时间": "2025-08-06",
      "任务": [
        {
          "id": "P1-T001",
          "描述": "设计区块数据接口，扩展DocumentResult类型",
          "文件": "frontend/src/types/index.ts",
          "预计时间": "1小时",
          "状态": "已完成",
          "实际完成时间": "2025-08-06"
        },
        {
          "id": "P1-T002", 
          "描述": "修改后端API，返回middle.json数据",
          "文件": "backend/api/results.py",
          "预计时间": "2小时",
          "状态": "已完成",
          "实际完成时间": "2025-08-06"
        },
        {
          "id": "P1-T003",
          "描述": "创建区块数据处理工具函数",
          "文件": "frontend/src/utils/blockProcessor.ts",
          "预计时间": "2小时",
          "状态": "已完成",
          "实际完成时间": "2025-08-06"
        }
      ]
    },
    
    "阶段2": {
      "名称": "PDF区块标记功能",
      "任务": [
        {
          "id": "P2-T001",
          "描述": "创建PDF区块叠加组件PDFBlockOverlay",
          "文件": "frontend/src/components/pdf/PDFBlockOverlay.tsx",
          "预计时间": "4小时"
        },
        {
          "id": "P2-T002",
          "描述": "实现坐标转换和区块绘制逻辑",
          "文件": "frontend/src/utils/pdfCoordinates.ts",
          "预计时间": "3小时"
        },
        {
          "id": "P2-T003",
          "描述": "集成区块标记到FilePreview组件",
          "文件": "frontend/src/components/FilePreview.tsx",
          "预计时间": "2小时"
        }
      ]
    },
    
    "阶段3": {
      "名称": "Markdown区块标记功能",
      "任务": [
        {
          "id": "P3-T001",
          "描述": "创建带区块标记的Markdown渲染器",
          "文件": "frontend/src/components/markdown/BlockMarkdownViewer.tsx",
          "预计时间": "3小时"
        },
        {
          "id": "P3-T002",
          "描述": "实现内容映射算法，匹配JSON区块与Markdown段落",
          "文件": "frontend/src/utils/contentMatcher.ts",
          "预计时间": "4小时"
        },
        {
          "id": "P3-T003",
          "描述": "添加区块高亮和点击交互样式",
          "文件": "frontend/src/components/markdown/block-styles.css",
          "预计时间": "1小时"
        }
      ]
    },
    
    "阶段4": {
      "名称": "同步交互功能",
      "任务": [
        {
          "id": "P4-T001",
          "描述": "实现区块选择状态管理",
          "文件": "frontend/src/hooks/useBlockSync.ts",
          "预计时间": "2小时"
        },
        {
          "id": "P4-T002", 
          "描述": "实现双向滚动同步机制",
          "文件": "frontend/src/hooks/useScrollSync.ts",
          "预计时间": "4小时"
        },
        {
          "id": "P4-T003",
          "描述": "实现点击高亮和自动定位功能",
          "文件": "frontend/src/utils/blockInteraction.ts",
          "预计时间": "3小时"
        }
      ]
    },
    
    "阶段5": {
      "名称": "集成和优化",
      "任务": [
        {
          "id": "P5-T001",
          "描述": "集成所有功能到DocumentViewer对照标签页",
          "文件": "frontend/src/components/DocumentViewer.tsx",
          "预计时间": "3小时"
        },
        {
          "id": "P5-T002",
          "描述": "性能优化：虚拟滚动和区块缓存",
          "文件": "frontend/src/utils/performanceOptimization.ts",
          "预计时间": "4小时"
        },
        {
          "id": "P5-T003",
          "描述": "添加用户配置选项（区块显示开关、同步模式等）",
          "文件": "frontend/src/components/settings/BlockSyncSettings.tsx",
          "预计时间": "2小时"
        },
        {
          "id": "P5-T004",
          "描述": "错误处理和降级方案（无JSON数据时的处理）",
          "文件": "frontend/src/utils/errorHandling.ts",
          "预计时间": "2小时"
        }
      ]
    }
  },

  "技术细节": {
    "区块标记设计": {
      "PDF区块标记": {
        "样式": "半透明彩色边框，左上角显示序号",
        "颜色方案": "text区块蓝色，title区块绿色，image区块橙色",
        "交互": "鼠标悬停显示内容预览，点击高亮并同步"
      },
      "Markdown区块标记": {
        "样式": "左侧边条标记，内容区域背景高亮",
        "序号显示": "在段落前添加小图标序号",
        "交互": "点击任意段落高亮并同步到PDF"
      }
    },
    "坐标转换算法": {
      "PDF坐标系": "左下角为原点(0,0)，向上向右为正",
      "Canvas坐标系": "左上角为原点(0,0)，向下向右为正", 
      "转换公式": "canvasY = pageHeight - pdfY",
      "缩放适配": "根据PDF显示缩放比例调整区块位置"
    },
    "内容映射策略": {
      "精确匹配": "优先使用content字段完全匹配",
      "模糊匹配": "去除标点和空格后的相似度匹配",
      "位置推断": "根据index顺序和页面位置推断对应关系",
      "容错处理": "无法匹配时显示警告，不影响其他功能"
    }
  },

  "用户体验设计": {
    "视觉设计": {
      "区块标记": "使用统一的设计语言，与现有UI风格保持一致",
      "动画效果": "平滑的滚动动画和高亮过渡效果",
      "响应式": "适配不同屏幕尺寸，移动端优化"
    },
    "交互设计": {
      "直观操作": "点击任意区块即可同步，无需额外学习成本",
      "状态反馈": "清晰的高亮状态和滚动位置指示",
      "快捷操作": "键盘导航支持（上下箭头切换区块）"
    },
    "设置选项": {
      "显示控制": "可以开关区块标记显示",
      "同步模式": "自动同步/手动同步模式切换"
    }
  },

  "测试计划": {
    "单元测试": [
      "坐标转换函数测试",
      "内容匹配算法测试", 
      "区块状态管理测试"
    ],
    "集成测试": [
      "PDF-Markdown同步功能测试",
      "多页文档处理测试",
      "错误场景处理测试"
    ],
    "用户测试": [
      "不同类型文档的对照效果测试",
      "交互流畅性测试",
      "性能压力测试"
    ]
  },

  "交付物": {
    "代码文件": [
      "区块数据处理相关工具函数",
      "PDF区块叠加组件",
      "增强的Markdown渲染器",
      "同步交互hooks和工具",
      "集成的DocumentViewer组件"
    ],
    "配置文件": [
      "TypeScript类型定义更新",
      "样式文件（CSS）",
      "组件配置文件"
    ],
    "文档": [
      "功能使用说明",
      "技术实现文档",
      "API接口文档"
    ]
  },

  "后续计划": {
    "短期优化": [
      "添加更多视觉自定义选项",
      "支持区块级别的编辑和标注",
      "导出带标记的PDF功能"
    ],
    "长期扩展": [
      "AI辅助的内容对照校验",
      "多文档对比功能",
      "协作标注和分享功能"
    ]
  }
}